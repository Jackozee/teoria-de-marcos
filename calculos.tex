\chapter{Cálculos con núcleos}
\label{ssec:calculos}

\subsubsection{Supremos de núcleos \tps{($NA$)}{NA}.}

Ya probamos que los supremos no vacíos en $DA$ y en $SA$ se
calculan puntualmente, y que los supremos dirigidos en $PA$
también.
Sin embargo, aún queda encontrar una descripción para, al menos,
algunos supremos en $NA$.
Comenzaremos con una observación sencilla.
\begin{obs}[Sobre conjuntos dirigidos]
  Dadas dos derivadas $f$ y $g$ en $A$,
  para todo $a\in A$ tenemos $a\leq g(a)$ y,
  aplicando $f$, se sigue que $f(a)\leq f(g(a))$.
  Como $f$ también infla, tenemos $g(a)\leq f(g(a))$.
  Así, $f,g\leq fg$. En particular, si una familia no vacía de
  derivadas $J$ es cerrada bajo composición, entonces $J$ es un
  conjunto dirigido.

  Similarmente, podemos mostrar que $f,g\leq gf$, así que  $f,g\leq
  fg\inf gf$. Luego,
  \[
    f\psup g \leq fg\inf gf
  .\]
\end{obs}

Sea $J\subseteq NA$ un conjunto no vacío de núcleos.
Como $J\subseteq SA$, entonces $\pSup J$ es el supremo de $J$ en $SA$.
Además, como la familia $J^\circ$
de composiciones finitas de elementos de $J$
\[
  J^\circ = \{j_1\cdots j_m \mid j_i\in J \text{ para } 1\leq
  i\leq m\}
\]
es cerrada bajo composiciones, por la observación anterior, $J^\circ$
es una familia dirigida de prenúcleos, así que $\pSup J^\circ$
es el supremo de $J^\circ$ en $PA$.

\begin{lemma}
  Si $J\subseteq NA$ es una familia no vacía de núcleos sobre un
  marco $A$, entonces el núcleo
  \[
    \left(\pSup J\right)^\infty = \left(\pSup J^\circ\right)^\infty
  \]
  es el supremo de $J$ en $NA$.
\end{lemma}
\begin{proof}
  Sean
  \begin{align*}
    j &= \left(\pSup J\right)^\infty &
    k &= \left(\pSup J^\circ\right)^\infty.
  \end{align*}
  Es claro que $j$ y $k$ son núcleos que acotan superiormente a
  $J$.
  Si $l\in NA$ es un núcleo que acota superiormente a $J$, entonces
  también acota superiormente a $J^\circ$, ya que
  \[
    j_1\cdots j_m \leq l^m = l
  \]
  para cualquier $j_1\cdots j_m\in J$.
  Luego, $\pSup J\leq l$ y $\pSup J^\circ \leq l$,
  pues $\pSup J,\pSup J^\circ\in SA$ son los supremos de $J$ y $J^\circ$
  (respectivamente) en $SA$ y $l\in SA$.
  Se sigue que $j,k\leq l$, pues $j$ y $k$ son el menor núcleo por
  encima de $\pSup J$ y $\pSup J^\circ$, respectivamente.
\end{proof}

Uno de los pasos de la demostración anterior
nos permite mostrar un resultado bastante útil.
\begin{cor}
    Sea $J$ una familia de núcleos.
    Si $j\in J^\circ$ es una cota superior de $J$
    y es idempotente, entonces $j=\Sup J$ en $NA$.
    
    En particular, esto sucede cuando $J$ es finito y todos los
    elementos de $J$ aparecen en $j=j_1\cdots j_n\in J^\circ$.
\end{cor}
\begin{proof}
    Nótese que $j=j_1\cdots j_n\in J^\circ$
    es un prenúcleo porque es composición de prenúcleos.
    Como también es idempotente, se sigue que $j\in NA$.
    Ahora, para cualquier núcleo $k\in NA$ que acote a $J$ por arriba,
    tenemos
    \[
        j = j_1\cdots j_n \leq k^n = k
    .\]
    Luego, $j=\Sup J$ en $NA$.
\end{proof}

\subsubsection{Los núcleos abiertos y cerrados son complementarios}

Recordemos que cualquier elemento $a$ de un marco $A$ tiene
asociados los núcleos $\unuc a$ y $\vnuc a$ dados por
\begin{align*}
  \unuc a(x) &= a\sup x
  &
  \vnuc a(x) &= (a\succ x).
\end{align*}
No es difícil ver que
\begin{align*}
  \unuc 1 &= \tp = \vnuc 0 \\
  \unuc 0 &= \id = \vnuc 1.
\end{align*}

Esto se puede generalizar para cualquier elemento $a\in A$.

\begin{lemma}
  Sea $A$ un marco.
  Para cualquier $a\in A$ se tiene
  \begin{align*}
    \vnuc a\inf\unuc a &= \id
    &
    \vnuc a\sup\unuc a &= \tp
  \end{align*}
  en $NA$.
  Es decir, $\unuc a$ y $\vnuc a$ son complementos uno del otro.
\end{lemma}
\begin{proof}
Sabemos que $\unuc a\vee \vnuc a=(\vnuc a\circ \unuc a)^\infty$, pero $(\vnuc a\circ \unuc a)(x)=(a\succ (a\vee x))=1$, para toda $x\in A$. Entonces $\vnuc a\vee \unuc a=(\vnuc a\circ \unuc a)^\infty=\tp$.\\
Además, $(\vnuc a\wedge \unuc a)(x)=\vnuc a(x)\wedge \unuc a(x)=(a\succ x)\wedge (a\vee x)=x\vee (a\wedge x)=x$. Es decir, $\vnuc a\wedge \unuc a=\id$.\\
Por lo tanto $\unuc a$ y $\vnuc a$ son complementados.
\end{proof}

\begin{lemma}[Equivalencias]
  \label{lemma:equivalencias}
  Sea $A$ un marco.
  Entonces
  \begin{align*}
    \unuc a\leq j &\iff a\leq j(0), &
    \vnuc a\leq j &\iff 1=j(a), &
    j\leq \wnuc a &\iff j(a)=a.
  \end{align*}
  (Nótese que el lema \ref{lemma:nucleos-densos}
  es la tercera equivalencia para el caso $a=0$).
  Además,
  \begin{equation}
    j\leq \vnuc a \iff a\leq\iota(j)
  ,\end{equation}
  donde $\iota(j)=\Inf\{(j(x)\succ x)\mid x\in A\}$.
\end{lemma}
\begin{proof}
    Si $\unuc a \leq j$, entonces
    $a=\unuc a(0) \leq j(0)$.
    Por otro lado, si $a\leq j(0)$, entonces para todo $x\in A$
    tenemos
    \begin{align*}
      \unuc a (x)
      &= a\sup x \\
      &\leq j(0) \sup x \\
      &\leq j(0) \sup j(x) \\
      &= j(x).
    \end{align*}
    Luego, $\unuc a \leq j$.
    
    Supongamos que $\vnuc a\leq j$.
    Evaluando en $a$, obtenemos $1=(a\succ a)\leq j(a)$,
    así que $1=j(a)$.
    Por otro lado, supongamos que $1=j(a)$.
    Para todo $x\in A$, tenemos $\vnuc a(x)=a\succ x$,
    por lo cual $\vnuc a(x)\inf a\leq x$.
    Aplicando $j$, obtenemos
    \begin{align*}
        j(x)
        &\geq j(\vnuc a(x)\inf a) \\
        &= j(\vnuc a(x))\inf j(a) \\
        &= j(\vnuc a(x))\inf 1 \\
        &\geq j(\vnuc a(x)) \\
        &\geq \vnuc a(x).
    \end{align*}
    Luego, $\vnuc a\leq j$.
    
    Ahora supongamos que $j\leq\wnuc a$.
    Evaluando en $a$, obtenemos $j(a)\leq a$.
    Como $j$ infla, esto es equivalente a $j(a)=a$.
    Por otro lado, supongamos que $j(a)=a$.
    Debemos mostrar que $j\leq\wnuc a$;
    esto es: que $j(x)\leq((x\succ a)\succ a)$
    para todo $x\in A$.
    Recordando que siempre tenemos $x\inf(x\succ a)=x\inf a$,
    se sigue que
    \begin{align*}
        j(x)\inf(x\succ a)
        &\leq j(x)\inf j(x\succ a) \\
        &= j(x\inf (x\succ a)) \\
        &= j(a) \\
        &= a.
    \end{align*}
    Luego, $j(x)\leq((x\succ a)\succ a)=\wnuc a(x)$.

    Finalmente, notemos que
    \begin{align}
      j\leq \vnuc a
      &\iff j\leq\neg\unuc a \\
      &\iff \unuc a\inf j=0_{NA}=\id \\
      &\iff \forall x\in A, j(x)\inf(a\sup x)=x \\
      &\iff \forall x\in A, (j(x)\inf a)\sup x=x \\
      &\iff \forall x\in A, j(x)\inf a\leq x \\
      &\iff \forall x\in A, a\leq (j(x)\succ x) \\
      &\iff a\leq\Inf\{(j(x)\succ x)\mid x\in A\} \\
      &\iff a\leq\iota(j),
    \end{align}
\end{proof}
\begin{cor}[El mayor cerrado por debajo y el mayor abierto por arriba]
  De la primera y la última equivalencias del lema anterior
  \begin{align}
    \unuc a\leq j &\iff a\leq j(0), &
    j\leq \vnuc a &\iff a\leq\iota(j)
  \end{align}
  se sigue que $\unuc{j(0)}$ es el mayor núcleo cerrado que está
  debajo de $j$ y que $\vnuc {\iota(j)}$ es el menor núcleo abierto
  que está encima de $j$.
\end{cor}

\begin{lemma}\label{lemma:sup-is-comp}
  Sea $A$ un marco y $j,k\in NA$ núcleos.
  Si $jk\leq kj$, entonces $k\sup j = kj$.
\end{lemma}
\begin{proof}
  Supongamos que $jk\leq kj$.
  Sea $g=kj$.
  Entonces
  \begin{align*}
    g^2
    &= kjkj \\
    &\leq kkjj \\
    &= k^2j^2 \\
    &= kj \\
    &= g.
  \end{align*}
  Es decir, $g$ es un prenúcleo idempotente, y así $g\in NA$
  es un núcleo por encima de $k$ y de $j$.

  Ahora, si $h\in NA$ es cualquier núcleo con $j\leq h$ y $k\leq
  h$, entonces $g=kj\leq h^2=h$.
  Se sigue que $g=k\sup j$.
\end{proof}

\begin{lemma}[Supremos con núcleos abiertos y cerrados]
  \label{lemma:sup-ab-cerr}
  Sea $A$ un marco.
  Dado cualquier núcleo $j\in NA$ y elementos $a,b\in A$, tenemos
  \begin{enumerate}
    \item\label{item:1} $j\sup\unuc a = j\unuc a$,
    \item\label{item:2} $\vnuc b \sup j = \vnuc b j$.
  \end{enumerate}
  En consecuencia
  \begin{equation}
    \vnuc b \sup j \sup \unuc a = \vnuc b j \unuc a
  .\end{equation}
\end{lemma}
\begin{proof}
  \ref{item:1}.
  Por el lema anterior (\ref{lemma:sup-is-comp}),
  basta probar $\unuc a j \leq j\unuc a$.
  Tenemos
  \begin{align}
    \unuc a j (x)
    &= a\sup j(x) \\
    &\leq j(a)\sup j(x) \\
    &\leq j(a\sup x) \\
    &= j\unuc a(x)
  .\end{align}
  
  \ref{item:2}.
  Por el lema anterior (\ref{lemma:sup-is-comp}), basta probar 
  $j\vnuc b \leq \vnuc b j$.
  Es decir, hay que probar que $j(b\succ x) \leq (b\succ j(x))$
  para todo $x\in A$.
  Para esto, observemos que
  \begin{align*}
    j(b\succ x) \inf b
    &\leq j(b\succ x) \inf j(b) \\
    &= j((b\succ x)\inf b) \\
    &= j(b\inf x) \\
    &\leq j(x).
  \end{align*}
  Usando la definición de la implicación, esto nos da $j(b\succ
  x) \leq (b\succ j(x))$, que es lo que queríamos.
\end{proof}

\begin{lemma}
    Sean $A$ un marco y $a\in A$.
    Si $j\in NA$ es un núcleo tal que $\wnuc a\leq j$, entonces
    \[
        j = \wnuc a \sup\unuc b = \wnuc b
    ,\]
    donde $b=j(0)$.
    En particular, este resultado implica que los núcleos
    regulares forman una sección superior.
    
    También nótese que, por el lema \ref{lemma:sup-ab-cerr},
    %[\nameref{lem:sup-ab-cerr}],
    tenemos $\wnuc a \sup\unuc b = \wnuc a\unuc b$.
\end{lemma}
\begin{proof}
    Como $b\leq j(0)$, tenemos
    $\unuc b\leq j$ (lema \ref{lemma:equivalencias}).
    Luego,
    \[
        \wnuc a\sup\unuc b\leq j
    .\]
    Notemos, además, que $j(b)=j(j(0))=j(0)=b$,
    lo cual sucede si, y solo si,
    \[
        j \leq \wnuc b
    ,\]
    (lema \ref{lemma:equivalencias}). Finalmente, resta probar que
    $\wnuc b\leq \wnuc a\sup\unuc b$.
    Por nuestro caballo de batalla,
    esto es equivalente a $\wnuc b\inf\vnuc b\leq \wnuc a$
    lo cual sucede si, y solo si, $(\wnuc b\inf\vnuc b)(a)=a$.
    Dado que $\wnuc a\leq j$, tenemos
    $a=\wnuc a(0)\leq j(0)=b$.
    Luego, $(a\succ b)=1$, por lo cual
    \begin{align*}
        (\wnuc b\inf\vnuc b)(a)
        &= \wnuc b(a)\inf \vnuc b(a) \\
        &= ((a\succ b)\succ b)\inf (b\succ a) \\
        &= (1\succ b) \inf (b\succ a)\\
        &= b \inf (b\succ a) \\
        &= b\inf a \\
        &= a.
    \end{align*}
    Esto es lo que se quería mostrar.
\end{proof}

%\section*{SESIÓN 14: 28 OCT}

\begin{lemma}
    Sean $d\in DA$ y $j\in CA$.
    Entonces
    \[
        dj=j \ssi d\leq j \ssi jd=j
    .\]
\end{lemma}
\begin{proof}
    Probaremos la primera equivalencia,
    pues la segunda es completamente análoga.
    Supongamos que $jd=j$.
    Como $x\leq j(x)$, tenemos que $d(x)\leq d(j(x))=j(x)$.
    Luego, $d\leq j$.
    Por otro lado, si $d\leq j$, entonces tenemos
    $dj\leq jj=j$.
    La otra desigualdad ($j\leq dj$) se sigue porque $d$ infla.
\end{proof}

\begin{thm}
    Sean $A$ un marco y $a\in A$.
    Si $k\in NA$ es un núcleo tal que $\unuc a\leq k\leq\wnuc a$,
    entonces, para todo $j\in NA$ se tiene
    \[
        \wnuc a\sup j = \wnuc a j k = \wnuc b
    ,\]
    donde $b=\wnuc a(j(a))$.
\end{thm}
\begin{proof}
    Para la primera igualdad,
    basta ver que el prenúcleo $h=\wnuc ajk$ es idempotente
    y, por lo tanto, un núcleo.
    (En efecto, una vez probado esto, tendremos que
    cualquier núcleo $l$ que esté sobre $\wnuc a$ y $j$ queda
    por debajo de $h$, pues
    $h=\wnuc ajk\leq\wnuc aj\wnuc a\leq l^3=l$).
    
    Ahora, para probar la idempotencia de $h$,
    basta ver que $jh=h$ pues,
    por el resultado anterior,
    $k\leq\wnuc a$ implica $k\wnuc a=\wnuc a$,
    lo cual nos da
    \begin{align*}
        h^2
        &= \wnuc ajk\wnuc ajk \\ 
        &= \wnuc aj\wnuc ajk
            && (k\wnuc a=\wnuc a) \\ 
        &= \wnuc a\wnuc ajk
            && (jh=h)\\ 
        &= \wnuc ajk \\ 
        &= h.
    \end{align*}
    
    Probemos, pues, que $jh=h$.
    Sea $x\in A$ y definamos $y=jk(x)$,
    de modo que $jh(x)=h(x)$ es lo mismo que
    $j(\wnuc a(y))=\wnuc a(y)$.
    Una desigualdad es porque $j$ infla,
    así que queda probar la otra desigualdad:
    $j(\wnuc a(y))\leq\wnuc a(y)$,
    la cual equivale a $j(\wnuc a(y))\inf(y\succ a)\leq a$.
    Como $\unuc a\leq k$, tenemos $a\leq k(0)$, así que
    \begin{align*}
        j\wnuc a(y)\inf(y\succ a)
        &\leq j\wnuc a(y)\inf j(y\succ a) \\
        &= j(\wnuc a(y)\inf (y\succ a)) \\
        &= j(((y\succ a)\succ a)\inf (y\succ a)) \\
        &= j((y\succ a)\inf a) \\
        &= j(a) \\
        &\leq j(k(0)) && (a\leq k(0)) \\
        &\leq j(k(x)) \\
        &= y.
    \end{align*}
    Haciendo ínfimo con $(y\succ a)$, obtenemos
    \begin{align*}
        j(\wnuc a(y))\inf (y\succ a)
        &\leq y\inf (y\succ a) \\
        &= y\inf a \\
        &\leq a,
    \end{align*}
    que es lo que queríamos.
    
    Ahora veamos la otra igualdad.
    Evaluando las desigualdades $\wnuc a\leq k\leq \wnuc a$
    en $0$, obtenemos $k(0)=a$.
    Como $h=\wnuc ajk$ está por encima de $\wnuc a$,
    hace dos lemas vimos que $h=\wnuc b$, donde
    \begin{align*}
        b
        &= h(0) \\
        &= \wnuc ajk(0) \\
        &= \wnuc aj(a),
    \end{align*}
    como se quería.
\end{proof}

\begin{cor}
    Tomando $a=0$ en el resultado anterior,
    vemos que todo $j\in NA$ satisface
    \[
        j\sup\wnuc 0 = \wnuc{\neg\neg j(0)}
    .\]
\end{cor}

\begin{exa}%[Alfredo $\checkmark$]
  Consideremos el marco
  \[
      9 \hspace{10mm} = \hspace{10mm} 
      \begin{tikzcd}[row sep=3mm, column sep=3mm]
          & & 1 \\
          & p \ar[ur,no head] && q \ar[ul,no head] \\
          l \ar[ur,no head]
              && m \ar[ul,no head] \ar[ur,no head]
              && r \ar[ul,no head] \\
          & a \ar[ul,no head]\ar[ur,no head]
              && b\ar[ul,no head]\ar[ur,no head] \\
          & & 0 \ar[ul,no head]\ar[ur,no head]
      \end{tikzcd}
  \]
  Como los núcleos preservan los ínfimos y el $1$, un núcleo en $9$
  está determinado por su acción sobre $\{l,p,q,r\}$.
  Los núcleos regulares son
  \[ 
      \begin{array}{|c|c|c|c|c|}
          \hline
      \wnuc x & \wnuc x(l) & \wnuc x(p) & \wnuc x(q) & \wnuc x(r) \\
          \hline
    \wnuc 1 = \tp &  1   & 1    & 1    & 1 \\
          \wnuc p &  p   & p    & 1    & 1 \\
          \wnuc q &  1   & 1    & q    & q \\
          \wnuc l &  l   & 1    & 1    & 1 \\
          \wnuc m &  p   & p    & q    & q \\
          \wnuc r &  1   & 1    & 1    & r \\
          \wnuc a &  l   & 1    & q    & q \\
          \wnuc b &  p   & p    & 1    & r \\
          \wnuc 0 &  l   & 1    & 1    & r \\
          \hline
      \end{array}
  \]
  y los núcleos abiertos son
  \[ 
      \begin{array}{|c|c|c|c|c|}
          \hline
       \vnuc x & \vnuc x(l) & \vnuc x(p) & \vnuc x(q) & \vnuc x(r) \\
          \hline
    \vnuc 1 = \id &  l   & p    & q    & r \\
          \vnuc p &  l   & 1    & q    & r \\
          \vnuc q &  l   & p    & 1    & r \\
          \vnuc l &  1   & 1    & q    & r \\
          \vnuc m &  l   & 1    & 1    & r \\
          \vnuc r &  l   & p    & 1    & 1 \\
          \vnuc a &  1   & 1    & 1    & 1 \\
          \vnuc b &  1   & 1    & 1    & 1 \\
    \vnuc 0 = \tp &  1   & 1    & 1    & 1 \\
          \hline
      \end{array}
  \]
\end{exa}


\section{Descomposiciones de núcleos}

\begin{thm}[La representación en núcleos abiertos y cerrados]
  Sea $A$ un marco y $j$ un núcleo en $A$.
  Entonces
  \[
    j = \Sup\{ \unuc{j(a)}\inf\vnuc a \mid a\in A\}
  \]
  en $NA$.
\end{thm}
\begin{proof}
Sea $k=\bigvee\{\unuc {j(a)}\wedge \vnuc a\mid a\in A\}$.
Para cualesquiera $a,x\in A$, tenemos
\begin{align*}
  \unuc{j(a)}(x)
  &= j(a)\sup x \\
  &\leq j(a \sup x) \\
  &= j\unuc a(x).
\end{align*}
Luego, 
\begin{align*}
  \unuc{j(a)}
  &\leq j\unuc a \\
  &= j\sup \unuc a && \text{ por el lema anterior
  \ref{lemma:sup-ab-cerr}} \\
  &= \neg \vnuc a \sup j
    && \text{ pues } \neg\vnuc a = \unuc a \\
  &= (\vnuc a \succ j),
\end{align*}
es decir, $\unuc{j(a)} \inf \vnuc a \leq j$.
Así $k\leq j$.
Para la otra desigualdad, tomemos $a\in A$.
Entonces $(\unuc {j(a)}\wedge \vnuc a)(a)=j(a)\wedge (a\succ a)=j(a)\wedge 1=j(a)$;
es decir: $j(a)=(\unuc {j(a)}\wedge \vnuc a)(a)\leq k(a)$,
por lo cual $j\leq k$.
\end{proof}

\begin{cor}
  Si $A$ es un marco finito, entonces su ensamble $NA$ es un
  álgebra booleana completa.
\end{cor}
\begin{proof}
Por el teorema anterior cualquier $j\in NA$ tiene complemento, pues $j$ se puede expresar como un supremo finito de elementos complementados. Por lo tanto $NA$ es un álgebra booleana completa.
\end{proof}


\subsubsection{La descomposición de un núcleo generado por una derivada}

Ya probamos que todo núcleo $j\in NA$ se puede representar como
\[
    j = \Sup\{\unuc{j(a)}\inf \vnuc a \mid a\in A \}
.\]
Si existe una derivada $f\in DA$ tal que $j=f^\infty$,
esta construcción se puede mejorar.
En esta sección, fijamos una derivada $f\in DA$ y suponemos que
$j=f^\infty\in NA$.
Usando la cadena de iteraciones de $f$, construiremos una cadena
en $A$, y luego una cadena en $NA$.
\begin{itemize}
  \item
  Para cada $a\in A$ y cada ordinal $\alpha$, definimos
  $a(\alpha)=f^\alpha(a)$.
  Esto nos da una cadena en $A$
  \[
    (a(\alpha) \mid \alpha\in\Ord)
  \]
  la cual, por cardinalidad, se estaciona en algún ordinal.
  En particular, por la definición de $a(\alpha)$, se tiene
  $a(\infty+1)=a(\infty)$ (recordemos que la cadena de los
  $f^\alpha$ se estaciona en el ordinal $\infty$).
  \item
  Usando la cadena anterior, construimos una nueva cadena en $NA$.
  \begin{align*}
    j_{a,0}
    &= \id_A \\
    j_{a,\alpha+1}
    &= (\unuc {a(\alpha+1)}\inf \vnuc {a(\alpha)})\sup j_{a,\alpha}
    \\
    j_{a,\lambda}
    &= \Sup\{j_{a,\alpha} \mid \alpha < \lambda\}
      & \text{(si $\lambda$ es límite).}
  \end{align*}
  Dado que los $a(\alpha)$ se estacionan, los $j_{a,\alpha}$ también.
  En efecto, si $a(\alpha) = a(\alpha+1)$, entonces
  \begin{align*}
    j_{a,\alpha+1}
    &= (\unuc {a(\alpha)}\inf \vnuc {a(\alpha)})
      \sup j_{a,\alpha} \\
    &= \id_A\sup j_{a,\alpha} \\
    &= j_{a,\alpha}.
  \end{align*}
  Sea $j_a$ el mayor de los $j_{a,\alpha}$.
  Es decir,
  \begin{align*}
    j_a
    &= \Sup\{j_{a,\alpha} \mid \alpha\in\Ord\} \\
    &= \Sup\{(\unuc {a(\alpha+1)}\inf\vnuc {a(\alpha)})
      \sup j_{a,\alpha} \mid \alpha\in\Ord\} \\
    &= \Sup\{\unuc {a(\alpha+1)}\inf\vnuc {a(\alpha)}
    \mid \alpha\in\Ord\}
  \end{align*}
  En particular, observemos que $j_a=j_{a,\infty}$.
\end{itemize}
El siguiente resultado nos dice que los núcleos
$j_{a,\alpha}$ tienen una descripción más simple.

\begin{lemma}
  Para cada ordinal $\alpha$, el núcleo $j_{a,\alpha}$ se puede
  expresar como
  \[
    j_{a,\alpha} = \unuc{a(\alpha)} \inf \vnuc a
  .\]
  En particular, para $\alpha=\infty$, tenemos
  \[
    j_a = j_{a,\infty} = \unuc{f^\infty(a)}\inf\vnuc a
  .\]
  Una consecuencia inmediata es que
  \[
    f^\infty = \Sup\{j_a \mid a\in A\}
  ,\]
  pues
  $f^\infty = \Sup\{\unuc{f^\infty(a)}\inf\vnuc a \mid a\in A\}$.
\end{lemma}
\begin{proof}
  Probamos la afirmación por inducción
  \begin{itemize}
    \item Para $\alpha=0$, tenemos $j_{a,0}=\id$, mientras que
    $\unuc{a(0)}\inf \vnuc a = \unuc a \inf \vnuc a = \id$.
    \item Supongamos que
    $j_{a,\alpha} = \unuc{a(\alpha)} \inf \vnuc a$.
    Entonces
    \begin{align*}
      j_{a,\alpha+1}
      &= (\unuc {a(\alpha+1)}\inf \vnuc {a(\alpha)})
        \sup j_{a,\alpha} \\
      &= (\unuc {a(\alpha+1)}\inf \vnuc {a(\alpha)})
        \sup (\unuc{a(\alpha)} \inf \vnuc a) \\
      &=
      (\unuc {a(\alpha+1)}\sup (\unuc{a(\alpha)} \inf \vnuc a))
      \inf(\vnuc {a(\alpha)}\sup (\unuc{a(\alpha)} \inf \vnuc a)) \\
      &= \unuc {a(\alpha+1)}
      \inf(\vnuc {a(\alpha)}\sup (\unuc{a(\alpha)} \inf \vnuc a)) \\
      &= \unuc {a(\alpha+1)}
      \inf(\vnuc {a(\alpha)}\sup\unuc{a(\alpha)})
      \inf(\vnuc {a(\alpha)}\sup \vnuc a) \\
      &= \unuc {a(\alpha+1)} \inf \tp \inf \vnuc a \\
      &= \unuc {a(\alpha+1)}\inf \vnuc a,
    \end{align*}
    como se quería.
    \item Si $\lambda$ es un ordinal límite, supongamos que 
    $j_{a,\alpha} = \unuc{a(\alpha)} \inf \vnuc a$ para todo
    ordinal $\alpha <\lambda$.
    Entonces
    \begin{align*}
      j_{a,\lambda}
      &= \Sup\{j_{a,\alpha} \mid \alpha<\lambda\} \\
      &= \Sup\{\unuc{a(\alpha)}\inf\vnuc a \mid\alpha<\lambda\}
      \\
      &= \Sup\{\unuc{a(\alpha)}\mid\alpha<\lambda\}\inf\vnuc a \\
      &= \unuc{\Sup\{a(\alpha)\mid\alpha<\lambda\}}\inf\vnuc a \\
      &= \unuc{a(\lambda)}\inf\vnuc a,
    \end{align*}
    como se deseaba.
  \end{itemize}
\end{proof}


Con este resultado, podemos probar que el núcleo $j=f^\infty$
tiene una descripción más simple que la canónica.

\begin{lemma}
  Si $f\in DA$ es una derivada tal que $f^\infty$ es un núcleo,
  entonces
  \[
    f^\infty = \Sup\{\unuc{f(a)}\inf\vnuc a \mid a\in A\}
  .\]
\end{lemma}
\begin{proof}
  Dado que
  \[
    \unuc{f(a)}\inf\vnuc a\leq \unuc{f^\infty(a)}\inf\vnuc a
  \]
  para todo $a\in A$, se sigue que
  \[
    \Sup\{\unuc{f(a)}\inf\vnuc a \mid a\in A\}
    \leq
    \Sup\{\unuc{f^\infty(a)}\inf\vnuc a \mid a\in A\}
    = f^\infty
  .\]

  Por otro lado, para cada $a\in A$ y cada ordinal $\alpha$, tenemos
  \[
    a(\alpha+1)=f^{\alpha+1}(a)=f(f^\alpha(a))=f(\alpha(a))
  ,\]
  por lo cual
  \[
     \unuc{a(\alpha+1)}\inf\vnuc{a(\alpha)}
     \in
     \{\unuc{f(b)}\inf\vnuc b \mid b\in A\}
  \]
  (poniendo $b=a(\alpha)$).
  Se sigue que
  \[
     \unuc{a(\alpha+1)}\inf\vnuc{a(\alpha)}
     \leq
     \Sup\{\unuc{f(b)}\inf\vnuc b \mid b\in A\}
  .\]
  Como esto es válido para todos los ordinales, tenemos
  \[
     j_a\leq \Sup\{\unuc{f(b)}\inf\vnuc b \mid b\in A\}
  ,\]
  pues $j_a = \Sup\{\unuc{a(\alpha+1)}\inf\vnuc{a(\alpha)}
   \mid\alpha\in\Ord\}$.
  De nuevo, como esto es válido para cualquier $a\in A$, concluimos
  que
  \[
     f^\infty\leq \Sup\{\unuc{f(b)}\inf\vnuc b \mid b\in A\}
  ,\]
  pues $f^\infty = \Sup\{j_a\mid a\in A\}$ (aquí es donde usamos
  el lema anterior).
\end{proof}

Recordemos que los núcleos regulares de un marco
(esto es, los de la forma $\wnuc a$) son exactamente
los que corresponden a sus cocientes booleanos.
Ahora probaremos que todo núcleo se puede descomponer en
núcleos regulares.

\begin{thm}[La descomposición en núcleos regulares]
    Sea $A$ un marco y $j:A\to A$ un núcleo.
    Entonces
    \[
        j
        = \Inf\{\wnuc{j(a)}\mid a\in A\}
        = \Inf\{\wnuc a\mid a\in A_j\}
    .\]
    Como $\{\wnuc{j(a)}\mid a\in A\}=\{\wnuc a \mid a\in A_j\}$,
    basta probar la primera igualdad.
\end{thm}
\begin{proof}
    Sea $l = \Inf\{\wnuc{j(a)}\mid a\in A\}$.
    En \ref{ssec:calculos} probamos que
    \[
        j\leq\wnuc a \ssi j(a) = a
    ,\]
    por lo cual $j\leq \wnuc{j(a)}$ para todo $a\in A$.
    Luego, $j\leq l$.
    Para la otra desigualdad,
    observemos que siempre tenemos $l\leq\wnuc{j(a)}$.
    Luego,
    \begin{align*}
        l(a)
        &\leq l(j(a)) \\
        &\leq \wnuc{j(a)}(j(a)) \\
        &= j(a),
    \end{align*}
    así que $l\leq j$, como se quería.
\end{proof}


